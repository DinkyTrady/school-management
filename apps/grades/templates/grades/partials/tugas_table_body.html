{% for tugas in tugas_list %}
<tr>
  <th>{{ forloop.counter }}</th>
  <td>
    <div class="font-bold">{{ tugas.nama }}</div>
    <div class="text-xs opacity-70">{{ tugas.mulai }} â†’ {{ tugas.tenggat }}</div>
  </td>
  <td>{{ tugas.jadwal.kelas.nama }}</td>
  <td>{{ tugas.jadwal.mapel.nama }}</td>
  <td>
    <span class="badge badge-outline"><i class="fa-regular fa-clock mr-1"></i>{{ tugas.tenggat }}</span>
  </td>
  <td>
    {% load permissions %}
    
    <!-- Use our new permission system -->
    <div class="flex space-x-1 items-center">
      <!-- View button (always available) -->
      <a href="{% url 'grades:tugas_detail' pk=tugas.pk %}" class="btn btn-sm btn-ghost btn-square" title="Detail">
        <i class="fa-solid fa-eye"></i>
      </a>
      
      <!-- Edit button (Guru and Admin only for tugas) -->
      {% if user|can_edit_model:"tugas" %}
      <a href="{% url 'grades:tugas_edit' tugas.pk %}" 
         class="btn btn-sm btn-warning btn-square" title="Edit">
        <i class="fa-solid fa-edit"></i>
      </a>
      {% endif %}
      
      <!-- Delete button (Guru and Admin only for tugas) -->
      {% if user|can_delete_model:"tugas" %}
      <button class="btn btn-sm btn-error btn-square" title="Hapus" 
              hx-delete="{% url 'grades:tugas_delete' tugas.pk %}"
              hx-confirm="Apakah Anda yakin ingin menghapus tugas '{{ tugas.nama }}'?"
              hx-target="closest tr"
              hx-swap="outerHTML">
        <i class="fa-solid fa-trash"></i>
      </button>
      {% endif %}
      
      <!-- Role-based access indicator -->
      {% if not user|can_edit_model:"tugas" %}
      <span class="text-xs text-gray-400 ml-2" title="Hanya dapat melihat">
        <i class="fas fa-eye-slash"></i>
      </span>
      {% endif %}
    </div>
  </td>
</tr>
{% empty %}
<tr>
  <td colspan="6" class="text-center py-8">
    <div class="text-gray-500">
      <i class="fa-solid fa-tasks text-6xl mb-4 opacity-30"></i>
      <div class="text-lg font-medium">Belum ada tugas terdaftar</div>
      <div class="text-sm">Tambah tugas baru untuk memulai</div>
    </div>
  </td>
</tr>
{% endfor %}

{{ pagination|safe }}
